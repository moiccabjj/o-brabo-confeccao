<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>O Brabo Confecção</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .navbar { background: #333; color: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    .navbar button { background: #d9534f; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
    .section { display: none; }
    .section.active { display: block; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    .btn { padding: 10px 20px; background: #5cb85c; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
    .btn-danger { background: #d9534f; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    table th, table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    table th { background: #f9f9f9; font-weight: bold; }
    .error { color: red; padding: 10px; margin: 10px 0; border: 1px solid red; border-radius: 5px; }
    .success { color: green; padding: 10px; margin: 10px 0; border: 1px solid green; border-radius: 5px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <div class="navbar">
      <h2>O Brabo Confecção</h2>
      <button onclick="logout()">Logout</button>
      <button onclick="showSection('clients')">Clientes</button>
      <button onclick="showSection('products')">Produtos</button>
      <button onclick="showSection('orders')">Pedidos</button>
      <button onclick="showSection('production')">Produção</button>
      <button onclick="showSection('finance')">Financeiro</button>
    </div>

    <div id="auth" class="section">
      <h2>Login</h2>
      <div id="loginMessage"></div>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="email" placeholder="seu@email.com" value="brabo@test.com">
      </div>
      <div class="form-group">
        <label>Senha:</label>
        <input type="password" id="password" placeholder="Sua senha" value="teste123">
      </div>
      <button class="btn" onclick="login()">Fazer Login</button>
    </div>

    <div id="au<div id="clients" class="section active">th" class="section">
      <h2>Clientes</h2>
      <div class="form-group">
        <label>Nome:</label>
        <input type="text" id="clientName" placeholder="Nome do cliente">
      </div>
      <button class="btn" onclick="addClient()">Adicionar Cliente</button>
      <table><thead><tr><th>ID</th><th>Nome</th><th>Ações</th></tr></thead><tbody id="clientsList"></tbody></table>
    </div>

    <div id="products" class="section">
      <h2>Produtos</h2>
      <div class="form-group">
        <label>Nome:</label>
        <input type="text" id="productName" placeholder="Nome do produto">
      </div>
      <div class="form-group">
        <label>Preço:</label>
        <input type="number" id="productPrice" placeholder="0.00">
      </div>
      <button class="btn" onclick="addProduct()">Adicionar Produto</button>
      <table><thead><tr><th>ID</th><th>Nome</th><th>Preço</th><th>Ações</th></tr></thead><tbody id="productsList"></tbody></table>
    </div>

    <div id="orders" class="section">
      <h2>Pedidos</h2>
      <div class="form-group">
        <label>Cliente:</label>
        <select id="orderClient"></select>
      </div>
      <button class="btn" onclick="addOrder()">Criar Pedido</button>
      <table><thead><tr><th>ID</th><th>Cliente</th><th>Status</th><th>Total</th><th>Ações</th></tr></thead><tbody id="ordersList"></tbody></table>
    </div>

    <div id="production" class="section">
      <h2>Produção</h2>
      <table><thead><tr><th>ID</th><th>Pedido</th><th>Etapa</th><th>Status</th><th>Ações</th></tr></thead><tbody id="productionList"></tbody></table>
    </div>

    <div id="finance" class="section">
      <h2>Financeiro</h2>
      <h3>Contas a Receber</h3>
      <table><thead><tr><th>ID</th><th>Pedido</th><th>Valor</th><th>Status</th></tr></thead><tbody id="receivablesList"></tbody></table>
      <h3>Contas a Pagar</h3>
      <table><thead><tr><th>ID</th><th>Descrição</th><th>Valor</th><th>Status</th></tr></thead><tbody id="payablesList"></tbody></table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://ezntiajdivnadmaxqbyu.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV6bnRpYWpkaXZuYWRtYXhxYnl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MTAzMDYsImV4cCI6MjA4MjI4NjMwNn0.Sk6SUIeBoJ_iNggUw668WK4n5y6XWS0kXrL3czkKre0';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    let currentUser = null;
    setTimeout(() => { currentUser = {id:'demo'}; showSection('clients'); loadData(); }, 100);

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const messageDiv = document.getElementById('loginMessage');
      
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        
        if (error) {
          messageDiv.innerHTML = '<div class="error">Erro: ' + error.message + '</div>';
          console.error('Login error:', error);
          return;
        }

        if (data && data.user) {
          currentUser = data.user;
          messageDiv.innerHTML = '<div class="success">Login realizado com sucesso!</div>';
          showSection('clients');
          loadData();
        }
      } catch (err) {
        messageDiv.innerHTML = '<div class="error">Erro: ' + err.message + '</div>';
        console.error('Exception:', err);
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      currentUser = null;
      showSection('auth');
      document.getElementById('loginMessage').innerHTML = '';
    }

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
    }

    async function addClient() {
      const name = document.getElementById('clientName').value;
      if (!name || !currentUser) return;
      const { error } = await supabase.from('clients').insert([{ name }]);
      if (!error) {
        document.getElementById('clientName').value = '';
        loadClients();
      }
    }

    async function addProduct() {
      const name = document.getElementById('productName').value;
      const price = parseFloat(document.getElementById('productPrice').value);
      if (!name || !price || !currentUser) return;
      const { error } = await supabase.from('products').insert([{ name, price }]);
      if (!error) {
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        loadProducts();
      }
    }

    async function addOrder() {
      const clientId = document.getElementById('orderClient').value;
      if (!clientId || !currentUser) return;
      const { error } = await supabase.from('orders').insert([{ client_id: clientId, status: 'pendente', total: 0 }]);
      if (!error) loadOrders();
    }

    async function loadClients() {
      if (!currentUser) return;
      const { data } = await supabase.from('clients').select('*');
      const html = (data || []).map(c => `<tr><td>${c.id}</td><td>${c.name}</td><td><button class="btn btn-danger" onclick="deleteClient(${c.id})">Excluir</button></td></tr>`).join('');
      document.getElementById('clientsList').innerHTML = html;
    }

    async function loadProducts() {
      if (!currentUser) return;
      const { data } = await supabase.from('products').select('*');
      const html = (data || []).map(p => `<tr><td>${p.id}</td><td>${p.name}</td><td>R$ ${p.price.toFixed(2)}</td><td><button class="btn btn-danger" onclick="deleteProduct(${p.id})">Excluir</button></td></tr>`).join('');
      document.getElementById('productsList').innerHTML = html;
    }

    async function loadOrders() {
      if (!currentUser) return;
      const { data } = await supabase.from('orders').select('*');
      const html = (data || []).map(o => `<tr><td>${o.id}</td><td>${o.client_id}</td><td>${o.status}</td><td>R$ ${(o.total || 0).toFixed(2)}</td><td><button class="btn btn-danger" onclick="deleteOrder(${o.id})">Excluir</button></td></tr>`).join('');
      document.getElementById('ordersList').innerHTML = html;
    }

    async function loadProduction() {
      if (!currentUser) return;
      const { data } = await supabase.from('production').select('*');
      const html = (data || []).map(p => `<tr><td>${p.id}</td><td>${p.order_id}</td><td>${p.stage}</td><td>${p.status}</td><td><button class="btn" onclick="updateProduction(${p.id})">Atualizar</button></td></tr>`).join('');
      document.getElementById('productionList').innerHTML = html;
    }

    async function loadFinance() {
      if (!currentUser) return;
      const { data: receivables } = await supabase.from('receivables').select('*');
      const { data: payables } = await supabase.from('payables').select('*');
      document.getElementById('receivablesList').innerHTML = (receivables || []).map(r => `<tr><td>${r.id}</td><td>${r.order_id}</td><td>R$ ${(r.amount || 0).toFixed(2)}</td><td>${r.status}</td></tr>`).join('');
      document.getElementById('payablesList').innerHTML = (payables || []).map(p => `<tr><td>${p.id}</td><td>${p.description}</td><td>R$ ${(p.amount || 0).toFixed(2)}</td><td>${p.status}</td></tr>`).join('');
    }

    async function loadData() {
      loadClients();
      loadProducts();
      loadOrders();
      loadProduction();
      loadFinance();
    }

    async function deleteClient(id) {
      await supabase.from('clients').delete().eq('id', id);
      loadClients();
    }

    async function deleteProduct(id) {
      await supabase.from('products').delete().eq('id', id);
      loadProducts();
    }

    async function deleteOrder(id) {
      await supabase.from('orders').delete().eq('id', id);
      loadOrders();
    }

    async function updateProduction(id) {
      const newStatus = prompt('Novo status:');
      if (newStatus) {
        await supabase.from('production').update({ status: newStatus }).eq('id', id);
        loadProduction();
      }
    }
  </script>
</body>
</html>
